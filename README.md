[![License](https://img.shields.io/badge/License-%C2%A9%202023%20minyoungkim-blue)](https://opensource.org/licenses/MIT)

# 농스타: LSTM을 활용한 기상 데이터 기반 농작물 가격 예측 서비스
2023 한국정책착회 빅데이터 분석 분야 프로젝트 평가 **한국정책학회장상(우수상)** 수상작입니다.

## Overview
1. 역할: 팀장(총 6명) - 데이터 수집 및 분석, PT 발표
2. 언어 및 툴: R, Python, HiveQL, Tableau
3. 주요 내용
- 물리한계검사와 기후범위검사 기준에 따라 월별 이상치 결측치로 처리
- 관측 지점/월별 선형/스플라인/지수평활/칼만필터 등 다양한 대체 방법 사용
- 계절성을 고려하기 위해 sin-cos 변수 및 월별 온도 변수 생성
- 주요 기상변수(온도, 압력, 강수량, 풍속)의 7일 평균 및 14일 평균이 가격과 상관이 높기 때문에 누적된 기상을 반영하는 변수 생성
- 각 기상변수에 지연 효과 반영하는 1시차~7시차, 14시차, 21시차, 28시차 변수 생성
- 지역별 생산량 가중치 적용 및 음수값과 왜곡 분포 보정하는 log변환
4. 주요 결과
- 기존 연구에서 다루어지지 않은 변수로 30일 이상의 중장기 일별 가격 예측 시도 및 품종별 차별화된 가격 예측 모델 전략 제시
- 총 100개 파생변수 생성으로 초기모델 대비 오차 감소율 94.1% 최종 모델 구축
- 22개 품목별 모델 선정 및  양파 품목 21년 기준 예측 오차값 RMSE 55 달성
### 문제 정의
- 지난달 7월 집중호우 발생으로 애호박 도매가격이 전일대비 63.3%상승하는 등 농산물 가격 급등으로 애그플레이션(Agriculture) 확산
- OECD 2019년 기준 한국은 고령자 상대적 빈곤율이 40% 초과하는 유일한 국가
- ‘제4차 저출산 제4차 저출산·고령사회 기본계획(2021~2025)'에 따르면 4차 산업혁명 기술 기반 노인 복지 서비스 확대 예정
  <br>


![image](https://github.com/min02yam/2023_2_tmp/assets/93497667/d4f14b23-58b3-4f32-b734-5bb2965a6fe4)

### 데이터 전처리

![image](https://github.com/min02yam/2023_2_tmp/assets/93497667/117926bd-cae7-404d-8b9d-7d06de30a434)

1. 데이터 수집
- 기간: 2016.01.01 ~ 2021.12.21(총 5년)

| 구분 | 데이터명 | 출처 |
|-------|-------|-------|
| 기상 | 방재기상관측(AWS)| [기상청 날씨마루](https://bd.kma.go.kr/kma2020/svc/main.do) |
| 기상 | 종관기상관측(ASOS) | [기상청 기상자료개방포털](https://data.kma.go.kr/cmmn/main.do) |
| 농작물 | 도매시장 품목별 거래 현황 | [농식품 빅데이터 거래소(KADX)](https://kadx.co.kr/) |
| 생산량<BR>재배면적 | 농작물 생산조사 | [국가통계포털(KOSIS)](https://kosis.kr/index/index.do) |

2. 결측치/이상치 파악
- 물리한계검사와 기후범위검사 기준에 따라 잠재적 이상치 결측치로 처리
- 기온의 경우 월별 허용범위에 따라 월별로 처리
- 타겟(가격)의 경우 음수값, 0, 혹은 시장 가격과 맞지 않는 잠재적 이상치가 존재하는 문제가 발생함
- 이를 해결하기 위해 QQ-plot, Anderson-Darling 정규성 검정 후 분포를 헤치지 않는 선에서 이상치로 처리함
4. 이상치 대체
- 최종 목표인 농산물 가격 예측에는 지역별 특징을 반영해 주어야 함
- 하나의 행정구역 안에는 관측지점이 다수 존재하는데, 관측지점별로 결측치가 매우 많았음. 이에
  1) 관측 지점 및 월별 선형/스플라인/지수평활/칼만필터 등 다양한 대체 방법 사용 후 가장 성능이 좋았던 스플라인 보간법 채택
  2) 행정동이 결측되었을 땐 시도별 평균값으로 대체함
  3) 광역시 단위의 행정구역은 IDW 보간법을 활용하여 대체함. 예를들어 2016-01-01 ~ 2019-05-30 세종의 값은 인접 지역인 대전, 천안, 청주의 거리별 가중치를 부여해서 보간

5. 파생변수 생성
- 계절성을 고려하기 위해 sin-cos 변수 및 월별 온도 변수 생성
- 주요 기상변수(온도, 압력, 강수량, 풍속)의 7일 평균 및 14일 평균이 가격과 상관이 높기 때문에 누적된 기상을 반영하는 변수 생성
- 각 기상변수에 지연 효과 반영하는 1시차~7시차, 14시차, 21시차, 28시차 변수 생성
6. 변수간 관계 파악
- 지역별 생산량 가중치 적용
- 왜곡 분포 보정하는 log변환시 기상 데이터 특성 상 음수값이 다수 존재했기에 이를 함께 보정함
- 명확한 레퍼런스에 의한 결측치 처리 및 이상치 대체를 하였기에 Min-Max 정규화 사용 
### 모델링
1. 목표
- 강한 해석력: 해석력의 장점을 가진 회귀분석과 
- 일반화 성능: 예측성능의 장점을 가진 머신러닝 모델을 모두 도출하여
- 농작물 가격에 영향을 미치는 요인을 비교 분석하고 오차값이 작은 최종 모형을 도출함
2. 강한 해석력
<img width="1047" alt="image" src="https://github.com/min02yam/NongStar/assets/93497667/fb122926-265e-47d4-aab6-94a9aa21cf4f">

3. 일반화 성능
- 일반화 성능과 해석력 확보를 위해 mljar 라이브러리를 활용하였고 XGboost와 LGBM을 앙상블한 모델을 최종 도출함
- SHARP Dependence plot 해석을 통해 회귀분석에서 도출한 영향요인과 유사한 패턴을 발견함
4. LSTM
- 성능은 앙상블 모델에 비해 떨어졌으나 선행연구에서 다루지 않았던 변수를 추가하였다는 점에서 의의가 있었음
### 주요 결과
- 기존 연구에서 다루어지지 않은 변수로 30일 이상의 중장기 일별 가격 예측 시도 및 품종별 차별화된 가격 예측 모델 전략 제시
- 총 100개 파생변수 생성으로 초기모델 대비 오차 감소율 94.1% 최종 모델 구축
- 22개 품목별 모델 선정 및 양파 품목 21년 기준 예측 오차값 RMSE 55 달성
### 활용방안 및 기대효과
<div style="display:flex;">
  <img width="50%" alt="image" src="https://github.com/min02yam/NongStar/assets/93497667/7dad73a9-6675-41d0-9d5d-18c3e68b897d">
  <img width="50%" alt="image" src="https://github.com/min02yam/NongStar/assets/93497667/5c58c3b2-6361-4f1f-ba78-92e7788b2222">
</div>

## 2. 파일구성
1. Data 폴더: Raw데이터 및 전처리 데이터 일체
2. Code 폴더: 각각 .Rmd/.ipynb
    - `01_Preprocess.Rmd`
    - `02_Modeling_MLR.Rmd`
     - `03_Modeling_LSTM.ipynb`

## 3. 코드실행 유의사항
데이터들을 'data' 폴더에 위치시켜 주시기 바랍니다.

## 4. 개발환경
### 4.1 로컬
- CPU : Intel(R) Core(TM) i7-10750H CPU @ 2.60GHz 2.59 GHz
- RAM : 16.0GB
- GPU : No GPU Computing
### 4.2 R
- R 버전 : 4.3.1
  - readr: 2.1.4 
  - readxl: 1.4.3
  - dplyr: 1.1.2
  - data.table: 1.14.8
  - magrittr: 2.0.3
  - skimr: 2.1.5
  - ggplot2: 3.4.2
  - esquisse: 1.1.2
  - DataExplorer: 0.8.2
  - lubridate: 1.9.2
  - stringr: 1.5.0
  - naniar: 1.0.0
  - VIM: 6.2.2
  - imputeTS: 3.3
  - fastDummies: 1.7.3
  - corrplot: 0.92
  - nortest: 1.0-4


### 4.3 Python 
Google Colab Pro
